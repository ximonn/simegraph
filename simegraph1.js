/*
 Simegraph JS

 (c) 2015 Padrone

 License: www.padrone.nl/license
*/
window.simegraph=function(a,R,h){function S(a,g,c){var e=0;c&&(e=c);c=R[e];var e=I.width,B=I.height,f=T.width,h=T.height;b.fastDraw||L.drawImage(a,0,0);d&&b.fastDraw||(d=L.getImageData(0,0,f,h).data);C||(U=D.getImageData(0,0,e,B),C=U.data);a=e-1;var h=0,u=B-1,J=0,y=-1,l=0,z=b.filterDepth,A=b.filterThreshold,v=4*z,w=4*f*z,n=parseInt(b.mask.substring(0,2),16),p=parseInt(b.mask.substring(2,4),16),k=parseInt(b.mask.substring(4,6),16);125<n?n-=b.jpgColorMargin:n+=b.jpgColorMargin;125<p?p-=b.jpgColorMargin:
p+=b.jpgColorMargin;125<k?k-=b.jpgColorMargin:k+=b.jpgColorMargin;var x=e-c.dx;c.w<x&&(x=c.w);B=B-c.dy;c.h<B&&(B=c.h);for(var m=0;m<B;m++)for(var t=f*(m+c.y)*4+4*c.x,r=e*(m+0+c.dy)*4+4*(0+c.dx),E=l=0;E<x;E++,t+=4,r+=4){var F=function(a){var H=!1;(125<n?d[a]>n:d[a]<n)&&(125<p?d[++a]>p:d[++a]<p)&&(125<k?d[++a]>k:d[++a]<k)&&(H=!0);return H},q=function(a){var H=!1;if((125<n?d[a]<n:d[a]>n)||(125<p?d[++a]<p:d[++a]>p)||(125<k?d[++a]<k:d[++a]>k))H=!0;return H};l<z&&q(t)&&l++;0<l&&(q=t+v,E+z<c.w&&F(q)?l-=
2:(q=t-w,0<=q&&F(q)?l-=2:(q=t+w,m+z<c.h&&F(q)&&(l-=2))));l>A&&(F=t,q=r,C[q]=d[F],C[++q]=d[++F],C[++q]=d[++F]);b.e&&g&&(l>A?(-1==y&&(E<a&&(a=E),m<u&&(u=m)),y=1):-1!=y&&(E>h&&(h=E),m>J&&(J=m),y=-1))}D.putImageData(U,0,0);if(b.e&&g)return 0==h&&(h=c.w),0==J&&(J=c.h),{a:a,b:u,c:h,d:J,m:c.dx,n:c.dy,p:c.w,o:c.h}}function Z(a){var g,c=a.src.split("/");g=c[c.length-1];c=a.g;1==c&&console.log("var compCoordinates = [");for(var e=!1,d=0;d<V.length;d++)V[d]==g&&(e=!0);e||V.push(g);if(!e){a=S(a,!0);var f=b.l,
e=a.c-a.a+4*f,d=a.d-a.b+4*f;A+e>=u.width&&(A=0,M+=N,N=0);var r=A+f,w=M+f;g='  {name:"'+g+'", x:'+A+",y:"+M+",w:"+(a.c-a.a+4*f)+",h:"+(a.d-a.b+4*f)+", dx:"+(a.m+a.a-2*f)+", dy:"+(a.n+a.b-2*f)+"}";a.a-=f;a.c+=f;a.b-=f;a.d+=f;for(var f=I.width,v=u.width,y=u.height,l=L.getImageData(0,0,f,I.height).data,y=K.getImageData(0,0,v,y),z=y.data,C=parseInt(b.mask.substring(0,2),16),D=parseInt(b.mask.substring(2,4),16),G=parseInt(b.mask.substring(4,6),16),n,p,k,x=a.a;x<a.c;x++)for(var m=a.b;m<a.d;m++){k=f*m*4+
4*x;var t=v*(w+m-a.b)*4+4*(r+x-a.a);0>x||x>=a.p||0>m||m>=a.o?(n=125<C?0:255,p=125<D?0:255,k=125<G?0:255):(n=l[k],p=l[++k],k=l[++k]);z[t]=n;z[++t]=p;z[++t]=k}K.putImageData(y,0,0);g=c==h.length-1?g+"\n];":g+",";console.log(g);d>N&&(N=d);A+=e}}function aa(a){for(var b=R.length,c=0,e=0;e<b&&!c;e++)R[e].name==a&&(c=e);return c}function W(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)if(a[b]+"Hidden"in document)return a[b]+"Hidden";return null}function O(){var a=
W();return a?document[a]:!1}function ba(){O()&&b.fastDraw&&D.drawImage(v,0,0)}function X(){function a(g){function c(){g++;g<h.length?a(g):b.e||(b.loop?(g=1,a(g)):0<b.i&&(g=1,setTimeout(function(){a.call(P,g)},b.i+(O()?1E3:0))));if(b.fastDraw)O()||w(r,!1,aa(h[e].name));else{var c=Y[e];G[e]?w(c):(console.log("info: image not available yet, nr:"+e),G[e]=w)}}var e=g,d=b.frameSpeed;if(b.fastDraw){var f=h[e].time;f&&(d=f)}setTimeout(function(){c.call(P)},d+(O()?200:0))}a(1)}var b={mask:a&&a.mask?a.mask:
"00FF00",canvas:a&&a.canvas?a.canvas:"myCanvas",canvasVirtual:a&&a.canvasVirtual?a.canvasVirtual:"canvasVirtual",k:a&&a.compositeFile?a.compositeFile:"composite.jpg",j:a?a.basicDraw?!0:!1:!1,fastDraw:a?a.fastDraw?!0:!1:!1,e:a?a.compositeDraw?!0:!1:!1,addReverseJpgFiles:a?a.addReverseJpgFiles?!0:!1:!0,frameSpeed:a&&a.frameSpeed?a.frameSpeed:33,waitTimeStart:a&&a.waitTimeStart?a.waitTimeStart:3E3,i:a&&a.waitTimeRepeat?a.waitTimeRepeat:3E3,loop:a&&a.loop?a.loop:!1,jpgColorMargin:a&&a.jpgColorMargin?
a.jpgColorMargin:6,filterDepth:a&&a.filterDepth?a.filterDepth:10,filterThreshold:a&&a.filterThreshold?a.filterThreshold:6,l:a&&a.cutMargin?a.cutMargin:8,f:a&&a.path?a.path:"img/"},I=document.getElementById(b.canvas),D=I.getContext("2d"),T=document.getElementById(b.canvasVirtual),L=T.getContext("2d"),u,K,d=null,U=null,C=null,P=this,V=[],A=0,M=0,N=0;if(a=W())a=a.replace(/[H|h]idden/,"")+"visibilitychange",document.addEventListener(a,ba);if(b.addReverseJpgFiles)for(a=h.length-2;0<a;a--)h.push(h[a]);
var G=Array(h.length),w;b.j?w=S:b.e&&(w=Z,u=document.getElementById("compositeCanvas"),K=u.getContext("2d"),K.fillStyle="#"+b.mask,K.fillRect(0,0,u.width,u.height));var Y=[],v=new Image,r=new Image;if(b.fastDraw)w=S,v.onload=function(){D.drawImage(this,0,0);Date.now||(Date.now=function(){return(new Date).getTime()});var a=Date.now();r.onload=function(){var d=b.waitTimeStart+a-Date.now();1>d&&(d=1);setTimeout(function(){L.drawImage(r,0,0);X.call(P)},d)};r.src=b.f+b.k;},v.src=b.f+h[0].name;else for(a=0;a<h.length;a++){var Q=new Image;Q.src=b.f+h[a].name;Q.g=a;Y.push(Q);Q.onload=0==a?function(){D.drawImage(this,0,0);setTimeout(function(){X.call(P)},b.waitTimeStart)}:function(){var a=this.g;if(0<=a)if(G[a])G[a](v[a]);else G[a]=!0}}};
